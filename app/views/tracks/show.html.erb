<div class='pull-right'>
<%= link_to 'Edit', edit_track_path(@track), class:'btn btn-info' %>
<%= link_to 'Back', project_path(@track.project), class:'btn btn-secondary' %>
</div>

<p id="notice"><%= notice %></p>

<p>
  <strong>Name:</strong>
  <%= @track.name %>
</p>

<p>
  <strong>Description:</strong>
  <%= @track.description %>
</p>

<p>
  <strong>Status:</strong>
  <%= @track.status %>
</p>


<div style="clear:both"></div>

<% if @track.unstarted? %>
  <%= form_with(model: [@track, Interval.new], local: true) do |form| %>
    <div class="actions">
      <%= form.hidden_field 'start_track', value: true %>

      <%= form.submit 'Start', class: 'btn btn-danger' %>
    </div>
  <% end %>

  <%= link_to 'Complete', new_track_interval_path(@track.id, close_track: true), class: 'btn btn-info' %>

<% elsif @track.progress? %>
  <% if @track.open_interval %>
    <%= form_with(model: [@track, @track.open_interval], local: true) do |form| %>
      <div class="actions">
        <%= form.hidden_field 'start_track', value: true %>

        <%= form.submit 'Pause', class: 'btn btn-info' %>
      </div>
    <% end %>

    <%= form_with(model: [@track, @track.open_interval], local: true) do |form| %>
      <div class="actions">
        <%= form.hidden_field 'close_track', value: true %>

        <%= form.submit 'Finish', class: 'btn btn-danger' %>
      </div>
    <% end %>
  <% else %>
    <%= form_with(model: [@track, Interval.new], local: true) do |form| %>
      <div class="actions">
        <%= form.hidden_field 'start_track', value: true %>

        <%= form.submit 'Resume', class: 'btn btn-danger' %>
      </div>
    <% end %>

    <%= form_with(model: [@track, @track.intervals.last], local: true) do |form| %>
      <div class="actions">
        <%= form.hidden_field 'close_track', value: true %>

        <%= form.submit 'Finish', class: 'btn btn-danger' %>
      </div>
    <% end %>
  <% end -%>
<% end -%>


<h1> Work intervals </h1>
  <% if @track.intervals.empty? %>
      <p> Not intervals available </p>
  <% else %>
    <table>
      <thead>
        <tr>
          <th> Start </th>
          <th> End </th>
          <th> User </th>
          <th colspan="3"></th>
        </tr>
      </thead>
      <% @track.intervals.each do |interval| %>
        <tr>
          <td><%= interval.start_at %>&nbsp&nbsp</td>
          <td><%= interval.end_at %>&nbsp</td>
          <td><%= interval.user.name + ' ' + interval.user.lastname %>&nbsp</td>
          <td>
            <%=
              link_to 'Destroy', track_interval_path(track_id: @track.id, id: interval.id),
              method: :delete, data: { confirm: 'Are you sure?' }
            %>
          </td>
        </tr>
      <%end%>
    </table>
<% end %>

<% if !@track.ready? %>
  <%= link_to 'Create interval', track_intervals_path(@track, automatic: true), method: :post, class: 'btn btn-success' %>
<% end %>
